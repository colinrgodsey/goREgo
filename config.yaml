# Main server listening address
listen_addr: ":50051"

# TLS configuration for the server
tls:
  enabled: false
  cert_file: "" # Path to server certificate (PEM)
  key_file: ""  # Path to server private key (PEM)
  client_auth: "none" # Client authentication mode: none, request, require, verify_if_given, require_and_verify
  ca_file: ""   # Path to CA certificate (PEM) for verifying client certs

# Local cache configuration
local_cache:
  enabled: true # Whether the local cache is enabled. Required if no backing cache is configured.
  dir: "/tmp/gorego/cache"
  max_size_gb: 10

force_update_atime: false # If true, force update access time on cache hits. Necessary for storage mounts with "noatime".

# Global log level for structured logging.
log_level: "warn" # Options: debug, info, warn, error

# Backing cache (Tier 2) configuration
backing_cache:
  target: "" # Address of the backing cache server (e.g., "grpcs://some-remote.com:443")
  # compression: "zstd" # Compression algorithm (e.g., "zstd" or empty)
  put_retry_count: 3 # Number of retries for remote put operations (default: 3)
  
  # TLS configuration for connecting to the backing cache
  tls:
    enabled: false
    cert_file: "" # Path to client certificate (PEM)
    key_file: ""  # Path to client private key (PEM)
    ca_file: ""   # Path to CA certificate (PEM) for verifying the server
    client_auth: "none" # Client authentication mode: none, request, require, verify_if_given, require_and_verify

# Telemetry configuration (metrics and tracing)
telemetry:
  metrics_addr: ":9090" # Prometheus metrics endpoint
  tracing_endpoint: "" # OpenTelemetry tracing endpoint (e.g., "otel.some-remote.com:4317")

# Execution engine configuration
execution:
  enabled: true # Enable the remote execution service
  concurrency: 0 # Number of concurrent workers (0 means use runtime.NumCPU())
  build_root: "/tmp/gorego/builds" # Root directory for execution builds
  queue_size: 1000 # Size of the execution request queue
  sandbox:
    enabled: false # Enable Linux sandboxing for execution
    binary_path: "/usr/bin/linux-sandbox" # Path to the linux-sandbox binary
    network_isolation: true # Isolate network inside the sandbox
    writable_paths: [] # Additional paths to make writable inside the sandbox (e.g., "/tmp")
    kill_delay: 5 # Seconds after timeout to send SIGKILL
    debug: false # Enable debug logging for the sandbox

# Cluster configuration (for distributed deployment)
cluster:
  enabled: false # Enable cluster mode for distributed execution
  # node_id: "" # Unique node identifier (auto-generated from hostname if empty)
  bind_port: 7946 # Port for gossip protocol (memberlist)
  # advertise_addr: "" # Address to advertise to peers (auto-detect if empty)
  broadcast_period: "500ms" # How often to broadcast state

  # Discovery mode: "list" for static peers, "dns" for DNS-based discovery
  discovery_mode: "list"

  # Static peer list (used when discovery_mode == "list")
  join_peers: []
  # join_peers: ["10.0.0.1:7946", "10.0.0.2:7946"]

  # DNS service name (used when discovery_mode == "dns")
  # Useful for Kubernetes Headless Services
  # dns_service_name: "gorego-headless.default.svc.cluster.local"

  # Unique node identifier (auto-generated from hostname if empty)
  # node_id: ""

  # Address to advertise to peers (auto-detect if empty)
  # advertise_addr: ""